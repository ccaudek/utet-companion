{
  "hash": "1250e701826ab39b64a6ed2dc556d9b4",
  "result": {
    "engine": "knitr",
    "markdown": "# Inferenza sulle proporzioni {#sec-bayes-inference-proportions}\n\n::: {.epigraph}\n> “Not everything that counts can be counted, and not everything that can be counted counts.”\n>\n> -- Spesso attribuita a William Bruce Cameron o Albert Einstein\n:::\n\n## Introduzione {.unnumbered .unlisted}\n\nDopo aver affrontato il problema dell’inferenza sulle medie, ci spostiamo ora a un altro scenario molto comune nella ricerca psicologica: l’*analisi delle proporzioni*. Capita spesso di voler confrontare la frequenza relativa di un certo evento tra due gruppi indipendenti. Per esempio, possiamo chiederci se la proporzione di soggetti che rispondono correttamente a un item sia più alta in un gruppo sperimentale rispetto a un gruppo di controllo, oppure se la proporzione di persone che presentano un sintomo clinico differisca tra due popolazioni.\n\nCome nel caso delle medie, anche qui il confronto diretto tra le proporzioni osservate può essere fuorviante, perché le differenze nei dati sono sempre accompagnate da *variabilità casuale*. Per interpretarle correttamente è necessario formulare un modello statistico che tenga conto dell’incertezza.\n\nL’approccio tradizionale è quello frequentista, che utilizza un *test di ipotesi* con l’ipotesi nulla di uguaglianza tra le proporzioni. Questo metodo, tuttavia, si limita a stabilire se i dati sono compatibili o meno con l’assenza di differenze, senza dirci nulla sull’ampiezza e sull’importanza sostantiva delle differenze stesse.\n\nL’approccio *bayesiano* rovescia la prospettiva. Non si tratta solo di stabilire se due proporzioni siano uguali o diverse, ma di *stimare quanto siano differenti* e con quale grado di incertezza. Questo significa ottenere una distribuzione a posteriori per la differenza tra proporzioni, da cui derivare probabilità direttamente interpretabili, come la probabilità che una proporzione sia maggiore dell’altra o che la differenza superi una soglia di rilevanza pratica. In questo modo, l’analisi diventa più informativa e più utile per supportare decisioni scientifiche.\n\nIn questo capitolo introdurremo dunque l’inferenza bayesiana sulle proporzioni, utilizzando il pacchetto *`brms`* in R. Per rendere il percorso graduale, partiremo dal caso più semplice dell’inferenza su una singola proporzione, per poi estendere i concetti al confronto tra due gruppi. Questo ci permetterà di apprezzare sia i limiti dell’approccio frequentista sia i vantaggi di quello bayesiano, che ci restituisce una descrizione completa della nostra incertezza.\n\n### Panoramica del capitolo {.unnumbered .unlisted}\n\n- Fondamenti dell'inferenza su una proporzione (modello Beta-Binomiale).\n- Confronto tra l'approccio frequentista (test e intervalli di confidenza) con quello bayesiano.\n- Concetto di ROPE per valutare la significatività pratica, e non solo statistica, di un effetto.\n- Estensione al confronto tra due proporzioni.\n- Linee guida per la reportistica e la pianificazione.\n\n\n::: {.callout-tip collapse=true}\n## Prerequisiti\n\n- Leggere il capitolo *Learning about a Binomial Probability* del testo di @albert_2019prob.\n:::\n\n::: {.callout-caution collapse=true title=\"Preparazione del Notebook\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhere::here(\"code\", \"_common.R\") |> \n  source()\n\n# Load packages\nif (!requireNamespace(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(cmdstanr, posterior, bayestestR, brms, tidyr, broom, tidybayes, scales)\n```\n:::\n\n:::\n\n\n## Inferenza su una proporzione\n\nCome esempio per l'inferenza su una proporzione, utilizzeremo i dati dello studio di @bruckner2005after, discussi anche da @wagenmakers2010bayesian. Nell'articolo *After the promise: the STD consequences of adolescent virginity pledges*, @bruckner2005after analizzano una serie di interviste condotte nell'ambito del National Longitudinal Study of Adolescent Health (Add Health). Lo studio si concentra sul comportamento sessuale di adolescenti, di età compresa tra 18 e 24 anni, che hanno fatto un \"virginity pledge\", ovvero una promessa pubblica o scritta di rimanere vergini fino al matrimonio. Studi scientifici indicano che il comportamento sessuale di questi adolescenti non sia statisticamente diverso da quello di chi non ha fatto tale promessa, con l'unica eccezione che i \"pledgers\" hanno una minore probabilità di utilizzare il preservativo durante il primo rapporto sessuale.\n\nI dati rilevanti per la nostra analisi sono i seguenti:\n\n- su 777 adolescenti che hanno fatto il \"virginity pledge\", 424 (54.6%) hanno dichiarato di aver usato il preservativo durante il primo rapporto sessuale;\n- su 9072 adolescenti che non hanno fatto la promessa, 5416 (59.7%) hanno dichiarato di aver usato il preservativo.\n\n\n### Obiettivo dell'analisi\n\nNella prima analisi, ci concentreremo sul campione di adolescenti che hanno fatto il \"virginity pledge\". Ci chiediamo se sia credibile pensare che questi adolescenti tendano ad avere un rapporto protetto, nel loro primo rapporto sessuale, in una proporzione minore di quella che ci si potrebbe aspettare in caso di casualità (ovvero, una proporzione di 0.5).\n\n\n### Analisi frequentista\n\nIniziamo con un test frequentista usando la funzione `prop.test()` per confrontare la proporzione osservata con il valore di riferimento 0.5.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprop_test_freq_vol <- prop.test(\n  x = 424,\n  n = 777,\n  p = 0.5\n)\n\ntidy(prop_test_freq_vol)\n#> # A tibble: 1 × 8\n#>   estimate statistic p.value parameter conf.low conf.high\n#>      <dbl>     <dbl>   <dbl>     <int>    <dbl>     <dbl>\n#> 1    0.546      6.31  0.0120         1    0.510     0.581\n#>   method                                               alternative\n#>   <chr>                                                <chr>      \n#> 1 1-sample proportions test with continuity correction two.sided\n```\n:::\n\n\nL'intervallo di confidenza frequentista non include il valore di riferimento 0.5, quindi, in base a questa analisi, possiamo concludere che la proporzione osservata (0.546) sia  *maggiore* del valore atteso in caso di casualità (0.5). \n\n\n### Approccio bayesiano \n\nSe utilizziamo dei prior non informativi, ci aspettiamo di giungere alla stessa conclusione anche con un approccio bayesiano. Tuttavia, l'approccio bayesiano ci permette di ottenere una distribuzione completa della probabilità a posteriori del parametro di interesse, offrendo una visione più ricca e flessibile rispetto all'approccio frequentista.\n\nIniziamo creando un data frame che sarà utilizzato con la funzione `brm()`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npledge_binomial_df <- tibble(\n  n_yes = 424,\n  n_total = 777\n)\n\n# tiny data\npledge_binomial_df\n#> # A tibble: 1 × 2\n#>   n_yes n_total\n#>   <dbl>   <dbl>\n#> 1   424     777\n```\n:::\n\n\n#### Modello bayesiano\n\nUtilizziamo un modello di regressione con una funzione link binomiale. Questo significa che stimeremo la proporzione $p$ con un modello di regressione beta-binomiale bayesiano utilizzando *brms*. Useremo un prior non informativo $\\mathcal{Beta}(1, 1)$. Questo è un modello solo con intercetta, senza altre covariate, poiché siamo interessati solo alla proporzione sottostante, senza condizionarla su altre variabili.\n\nIl modello può essere rappresentato come segue:\n\n$$\n\\begin{aligned}\ny_{\\text{condom\\_use}} &\\sim \\mathcal{Binomial}(n, \\pi) \\\\\n\\pi &= \\beta_0 \\\\\n\\beta_0 &\\sim \\mathcal{Beta}(1, 1)\n\\end{aligned}\n$$\n\nEseguiamo l'analisi bayesiana.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel_pledge_binomial <- brm(\n  n_yes | trials(n_total) ~ 1,\n  data = pledge_binomial_df,\n  family = binomial(link = \"identity\"),\n  prior = c(prior(beta(1, 1), class = \"Intercept\", lb = 0, ub = 1)),\n  chains = 4, warmup = 1000, iter = 4000, seed = 123,\n  refresh = 0,\n  backend = \"cmdstanr\"\n)\n```\n:::\n\n\nPoiché questo è un modello di regressione, si comporta come qualsiasi altro modello `brms`. Il coefficiente per l'intercetta rappresenta la proporzione stimata di adolescenti tra i 18 e i 24 anni che hanno usato il preservativo durante il primo rapporto sessuale nel campione.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(model_pledge_binomial)\n#>  Family: binomial \n#>   Links: mu = identity \n#> Formula: n_yes | trials(n_total) ~ 1 \n#>    Data: pledge_binomial_df (Number of observations: 1) \n#>   Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;\n#>          total post-warmup draws = 12000\n#> \n#> Regression Coefficients:\n#>           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\n#> Intercept     0.55      0.02     0.51     0.58 1.00     3835     5744\n#> \n#> Draws were sampled using sample(hmc). For each parameter, Bulk_ESS\n#> and Tail_ESS are effective sample size measures, and Rhat is the potential\n#> scale reduction factor on split chains (at convergence, Rhat = 1).\n```\n:::\n\n\nSi noti come l'intervallo di credibilità al 95% riproduce l'intervallo frequentista calcolato in precedenza.\n\n\n### Confronto tra i due approcci\n\nConfrontiamo ora i risultati ottenuti dai due approcci. L'analisi frequentista ha mostrato che la proporzione osservata (0.546) è significativamente maggiore del valore di riferimento 0.5. L'approccio bayesiano conferma questa conclusione, fornendo una distribuzione completa della probabilità a posteriori per la proporzione π.\nUno dei vantaggi dell'approccio bayesiano è la possibilità di incorporare informazioni a priori, se disponibili, migliorando così la robustezza delle inferenze. Inoltre, l'intervallo di credibilità bayesiano fornisce una descrizione più completa della distribuzione dei parametri, consentendo una migliore interpretazione dei risultati.\n\n### Modello Beta-Binomiale e soluzione analitica\n\nIn questo contesto, il problema può essere modellato utilizzando una distribuzione beta-binomiale, per la quale esiste una soluzione analitica per la distribuzione a posteriori. Il modello beta-binomiale è particolarmente adatto quando si lavora con dati binomiali (ad esempio, successi e fallimenti) e si desidera incorporare una distribuzione a priori coniugata per la proporzione $p$.\n\n#### Contestualizzazione del modello\n\nPer il gruppo \"pledgers\", abbiamo $y_1$ successi su $n_1$ prove. Se assumiamo una distribuzione a priori Beta($\\alpha$, $\\beta$), la distribuzione a posteriori per la proporzione $p_1$ sarà anch'essa una distribuzione Beta, data da:\n\n$$\np_1 \\mid y_1, n_1 \\sim \\mathcal{Beta}(\\alpha + y_1, \\beta + n_1 - y_1).\n$$\n\nNel nostro caso specifico, scegliamo una prior non informativa $\\mathcal{Beta}(1, 1)$, che equivale a una distribuzione uniforme sull'intervallo [0, 1]. Questa scelta riflette l'assenza di informazioni pregresse sulla proporzione $p_1$. Pertanto, la distribuzione a posteriori per il gruppo \"pledgers\" diventa:\n\n$$\np_1 \\mid y_1, n_1 \\sim \\mathcal{Beta}(1 + 424, 1 + 777 - 424) = \\mathcal{Beta}(425, 354).\n$$\n\n#### Calcolo dell'intervallo di credibilità\n\nUtilizziamo R per calcolare l'intervallo di credibilità al 95% basato sulla distribuzione a posteriori derivata analiticamente.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Parametri della distribuzione Beta\na_post <- 425  # Parametro alpha\nb_post <- 354  # Parametro beta\n\n# Calcolo dell'intervallo centrale al 95%\ncredibility_interval <- qbeta(c(0.025, 0.975), shape1 = a_post, shape2 = b_post)\nprint(credibility_interval)\n#> [1] 0.511 0.580\n```\n:::\n\n\nIl risultato ottenuto dall'analisi bayesiana analitica replica quello ottenuto tramite il modello `brm()` implementato in precedenza. Questo confronto tra approcci dimostra la coerenza tra le tecniche frequentista, bayesiana numerica e bayesiana analitica.\n\n### Discussione e confronto tra approcci\n\nL'utilizzo della distribuzione beta-binomiale e della soluzione analitica offre diversi vantaggi:\n\n1. *Semplicità*: La soluzione analitica è spesso più semplice da implementare rispetto ai metodi numerici, come quelli utilizzati in `brms`.\n2. *Velocità*: I calcoli sono generalmente più veloci poiché non richiedono iterazioni o campionamenti.\n3. *Interpretazione*: L'uso di distribuzioni coniugate facilita l'interpretazione dei risultati, fornendo direttamente la distribuzione a posteriori senza bisogno di complessi algoritmi di inferenza.\n\nTuttavia, l'approccio bayesiano numerico tramite `brms` presenta anche vantaggi significativi:\n\n1. *Flessibilità*: Può gestire modelli più complessi e includere covariate multiple.\n2. *Priori informativi*: Permette di incorporare facilmente informazioni a priori, se disponibili.\n3. *Estensioni*: Facilita l'estensione del modello a casi più complessi, come il confronto tra proporzioni di due gruppi.\n\n#### Analisi della distribuzione a posteriori\n\nEssendo un'analisi bayesiana, possiamo lavorare con l'intera distribuzione a posteriori e calcolare direttamente l'estimando, come la differenza tra la proporzione campionaria e la proporzione di riferimento (0.5).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npledge_draws <- model_pledge_binomial |> \n  spread_draws(b_Intercept) |> \n  mutate(diff = b_Intercept - 0.5)\n```\n:::\n\n\nVisualizziamo la distribuzione a posteriori della proporzione.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- ggplot(pledge_draws, aes(x = b_Intercept, y = \"Age 18–24\")) + \n  stat_halfeye(fill = \"gray\") +\n  geom_vline(xintercept = 0.5) +\n  scale_x_continuous(labels = label_percent()) +\n  coord_cartesian(ylim = c(1.5, 1.5)) +\n  labs(x = \"Proportion used a condom at first sex\", y = NULL)\np1\n```\n\n::: {.cell-output-display}\n![](02_one_proportion_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\nIl valore di riferimento (0.5) non è incluso nella distribuzione a posteriori, il che significa che la differenza tra la proporzione campionaria e la proporzione di riferimento non include lo zero, con un livello di credibilità del 95%. Possiamo quindi concludere, con un livello soggettivo di credibilità del 95%, che l'uso del preservativo durante il primo rapporto sessuale sia maggiore del caso, per gli adolescenti che hanno fatto il \"virginity pledge\".\n\n### La regione di equivalenza pratica \n\nL'analisi precedente confronta la proporzione osservata con un singolo valore di riferimento (0.5). Un approccio alternativo è considerare un intervallo di valori attorno a 0.5 che possano essere considerati \"praticamente equivalenti\" al valore di riferimento. Questo intervallo è chiamato *Regione di Equivalenza Pratica (ROPE)*.\n\nSecondo @kruschke2018bayesian, la ROPE può essere definita come un intervallo attorno al valore nullo (baseline) che corrisponde a un decimo della deviazione standard della distribuzione a posteriori del parametro di interesse. Nel nostro caso, il parametro di interesse è la proporzione $p$, e il valore nullo è 0.5. Per calcolare la ROPE, estraiamo i campioni a posteriori dal modello.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nposterior_samples <- as_draws_df(model_pledge_binomial)\n```\n:::\n\n\nCalcoliamo la deviazione standard a posteriori di $p$.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nposterior_std_dev <- sd(posterior_samples$b_Intercept)\nposterior_std_dev\n#> [1] 0.018\n```\n:::\n\n\nDefiniamo la ROPE come un intervallo attorno al valore di riferimento 0.5.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbaseline <- 0.5  # Valore nullo (baseline)\nrope_low <- baseline - 0.1 * posterior_std_dev\nrope_high <- baseline + 0.1 * posterior_std_dev\n```\n:::\n\n\nCalcoliamo ora la probabilità che la proporzione $p$ si trovi all'interno della ROPE.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrope_probability <-\n  mean(\n    posterior_samples$b_Intercept >= rope_low &\n      posterior_samples$b_Intercept <= rope_high\n  )\nrope_probability\n#> [1] 0.003\n```\n:::\n\n\nVisualizziamo la distribuzione a posteriori di $p$ insieme alla ROPE.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(posterior_samples, aes(x = b_Intercept)) +\n  geom_density(fill = \"gray\", alpha = 0.5) +\n  annotate(\n    geom = \"rect\", \n    xmin = rope_low, \n    xmax = rope_high, \n    ymin = 0, ymax = Inf, \n    fill = \"lightgray\", alpha = 0.2\n  ) +\n  geom_vline(xintercept = baseline, color = \"lightgray\") +\n  scale_x_continuous(labels = scales::percent) +\n  labs(x = \"Proportion used a condom at first sex\", y = \"Density\")\n```\n\n::: {.cell-output-display}\n![](02_one_proportion_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\nIn conclusione, dato che solo lo 0.325% (meno dell'uno per cento) della distribuzione a posteriori di $p$ si trova nella ROPE, possiamo concludere che ci sono evidenze credibili che la distribuzione a posteriori del parametro $p$ (la proporzione di adolescenti, di età compresa tra 18 e 24 anni, che hanno fatto il \"virginity pledge\" e hanno usato il preservativo durante il primo rapporto sessuale) sia diversa dal valore di riferimento 0.5. Nel caso specifico, questa proporzione è più alta, indicando che la tendenza ad avere un rapporto protetto è maggiore rispetto al caso di casualità, per questa popolazione.\n\n#### Discussione \n\nL'utilizzo della ROPE offre una prospettiva aggiuntiva nell'interpretazione delle inferenze bayesiane. Invece di semplicemente determinare se un parametro è statisticamente significativo rispetto a un valore di riferimento, la ROPE permette di valutare se le differenze osservate siano praticamente rilevanti in termini di impatto reale.\n\n- *Soglia di rilevanza*: L'impostazione di una ROPE consente di stabilire una soglia di rilevanza pratica. Se la maggior parte della distribuzione a posteriori cade al di fuori della ROPE, possiamo concludere che la differenza è non solo statistica ma anche pratica.\n- *Interpretazione clinica*: Nelle applicazioni pratiche, come in ambito medico o sociale, la ROPE aiuta a distinguere tra risultati statisticamente significativi ma clinicamente insignificanti e quelli che hanno un impatto rilevante.\n\nNel contesto dello studio sui \"pledgers\", l'uso della ROPE fornisce una valutazione più completa della tendenza degli adolescenti a utilizzare il preservativo durante il primo rapporto sessuale, dimostrando che questa tendenza è non solo statisticamente diversa dal caso di casualità, ma anche significativa dal punto di vista pratico.\n\n\n## Inferenza sulla differenza tra due proporzioni\n\nEstendiamo ora l'analisi precedente per confrontare le proporzioni di due gruppi, un compito per il quale non esiste una soluzione analitica semplice. Nello studio in esame, ci poniamo la domanda: *Fino a che punto l'analisi statistica supporta l'ipotesi che i \"pledgers\" abbiano una minore probabilità rispetto ai \"non-pledgers\" di usare il preservativo durante il primo rapporto sessuale?*\n\nPer testare questa ipotesi utilizzando *brms*, estendiamo il modello bayesiano includendo due gruppi: i *pledgers* (che hanno fatto il voto di astinenza) e i *non-pledgers* (che non lo hanno fatto). L'obiettivo è stimare la differenza tra le due proporzioni e valutare se questa sia credibilmente diversa da zero.\n\nCostruiamo un `tibble` con i dati relativi ai due gruppi:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npledge_data <- tibble(\n  group = c(\"pledgers\", \"nonpledgers\"),\n  n_yes = c(424, 5416),   # Numero di partecipanti che hanno usato il preservativo\n  n_total = c(777, 9072)  # Totale dei partecipanti per ciascun gruppo\n)\nprint(pledge_data)\n#> # A tibble: 2 × 3\n#>   group       n_yes n_total\n#>   <chr>       <dbl>   <dbl>\n#> 1 pledgers      424     777\n#> 2 nonpledgers  5416    9072\n```\n:::\n\n\n### Modello bayesiano per il confronto tra proporzioni\n\nIn questo modello, adottiamo un approccio bayesiano per analizzare la differenza nell'utilizzo del preservativo tra due gruppi distinti: i \"pledgers\" (chi ha sottoscritto l'impegno) e i \"non-pledgers\" (chi non lo ha sottoscritto). La struttura del modello si basa sulla distribuzione binomiale, appropriata per dati che rappresentano conteggi di successi su un numero fisso di prove.\n\n**Specifica del modello.** Il modello assume che il numero di utilizzi del preservativo in ciascun gruppo segua una distribuzione binomiale:\n\n$$\ny_i \\sim \\text{Binomial}(n_i, \\theta_i)\n$$\ndove:\n\n- $y_i$ è il numero di utilizzi del preservativo nel gruppo $i$,\n- $n_i$ è il numero totale di individui nel gruppo $i$,\n- $\\theta_i$ è la probabilità di utilizzo del preservativo nel gruppo $i$.\n\n**Modellazione delle probabilità.** La relazione tra i gruppi viene modellata attraverso una specificazione lineare sulla probabilità stessa (utilizzando un link identità):\n\n$$\n\\theta_i = \\beta_0 + \\beta_1 \\cdot x_i,\n$$\ndove:\n\n- $x_i$ è una variabile indicatrice che vale 0 per i non-pledgers e 1 per i pledgers,\n- $\\beta_0$ rappresenta la probabilità di utilizzo del preservativo nel gruppo di riferimento (non-pledgers),\n- $\\beta_1$ rappresenta la differenza assoluta nella probabilità di utilizzo tra pledgers e non-pledgers.\n\n**Scelta dei prior.** La specificazione dei prior riflette le nostre conoscenze a priori sui parametri:\n\n- Per $\\beta_0$ (probabilità base nei non-pledgers): utilizziamo un prior Beta(1,1), equivalente a una distribuzione uniforme tra 0 e 1, che rappresenta un'assenza di informazioni specifiche sulla probabilità attesa\n- Per $\\beta_1$ (differenza tra gruppi): utilizziamo un prior normale con media 0 e deviazione standard 1, che assegna probabilità decrescenti a differenze maggiori in valore assoluto, pur mantenendo la possibilità di effetti in entrambe le direzioni\n\n**Implementazione pratica.** L'implementazione del modello in `brms` utilizza la seguente sintassi:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel_pledge_diff <- brm(\n  formula = n_yes | trials(n_total) ~ group,  # Specifica della risposta binomiale\n  data = pledge_data,                         # Dataset contenente i dati\n  family = binomial(link = \"identity\"),       # Link identità per interpretazione diretta\n  prior = c(\n    prior(beta(1, 1), class = \"Intercept\", lb = 0, ub = 1),  # Prior per la probabilità base\n    prior(normal(0, 1), class = \"b\")                         # Prior per l'effetto del gruppo\n  ),\n  chains = 4,                 # Quattro catene Markoviane\n  warmup = 1000,              # 1000 iterazioni di burn-in per catena\n  iter = 4000,                # 4000 iterazioni totali per catena\n  seed = 123,                 # Seed per riproducibilità\n  refresh = 0,                # Nessun output intermedio\n  backend = \"cmdstanr\"        # Motore di inferenza efficiente\n)\n```\n:::\n\n\n\n### Risultati\n\nEsaminiamo il sommario del modello per valutare la stima della differenza tra le proporzioni:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(model_pledge_diff)\n#>  Family: binomial \n#>   Links: mu = identity \n#> Formula: n_yes | trials(n_total) ~ group \n#>    Data: pledge_data (Number of observations: 2) \n#>   Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;\n#>          total post-warmup draws = 12000\n#> \n#> Regression Coefficients:\n#>               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\n#> Intercept         0.60      0.01     0.59     0.61 1.00    13571     9174\n#> grouppledgers    -0.05      0.02    -0.09    -0.01 1.00     3602     4230\n#> \n#> Draws were sampled using sample(hmc). For each parameter, Bulk_ESS\n#> and Tail_ESS are effective sample size measures, and Rhat is the potential\n#> scale reduction factor on split chains (at convergence, Rhat = 1).\n```\n:::\n\n\nPer interpretare meglio i risultati, estraiamo i campioni a posteriori per la differenza tra le due proporzioni:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npledge_diff_draws <- model_pledge_diff |> \n  spread_draws(b_Intercept, b_grouppledgers) |> \n  mutate(\n    nonpledgers_prop = b_Intercept,  # Stima della proporzione nei non-pledgers\n    pledgers_prop = b_Intercept + b_grouppledgers,  # Stima della proporzione nei pledgers\n    diff = nonpledgers_prop - pledgers_prop  # Differenza tra le due proporzioni\n  )\n```\n:::\n\n\nVisualizziamo la distribuzione a posteriori della differenza:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np3 <- ggplot(pledge_diff_draws, aes(x = diff)) + \n  stat_halfeye(fill = \"gray\") +\n  geom_vline(xintercept = 0, linetype = \"dashed\") +\n  scale_x_continuous(labels = label_percent()) +\n  labs(x = \"Differenza nella proporzione di utilizzo del preservativo\", \n       y = \"Densità a posteriori\") \nprint(p3)\n```\n\n::: {.cell-output-display}\n![](02_one_proportion_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=85%}\n:::\n:::\n\n\nCalcoliamo la probabilità che la differenza tra le proporzioni sia maggiore di zero:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndiff_probability <- mean(pledge_diff_draws$diff > 0)\nprint(diff_probability)\n#> [1] 0.998\n```\n:::\n\n\n#### Interpretazione \n\nLa probabilità calcolata è *0.997*; ciò significa che c'è una probabilità del 99.7% che la proporzione di *non-pledgers* che usano il preservativo sia *maggiore* rispetto a quella dei *pledgers*. Questo supporta con elevata credibilità l'ipotesi che i *pledgers* abbiano meno probabilità di utilizzare il preservativo durante il primo rapporto sessuale.\n\nPossiamo quindi concludere che la differenza tra le due proporzioni è credibilmente diversa da zero, con un'elevata probabilità a favore dell'ipotesi che i *pledgers* abbiano una *minore* propensione all'uso del preservativo rispetto ai *non-pledgers*. Questi risultati riproducono quelli riportati dalla letteratura precedente, come discusso da @bruckner2005after.\n\n## Riflessioni conclusive {.unnumbered .unlisted}\n\nIn questo capitolo abbiamo visto come il problema del confronto tra proporzioni possa essere affrontato sia con l’approccio frequentista tradizionale, basato sui test di ipotesi, sia con l’approccio bayesiano. La differenza non è soltanto tecnica: il frequentismo ci dice se i dati sono compatibili o meno con l’ipotesi nulla di uguaglianza, mentre il bayesianesimo ci fornisce una *distribuzione a posteriori* per la differenza tra proporzioni, che quantifica direttamente la nostra incertezza e ci permette di calcolare probabilità interpretabili, come la probabilità che una proporzione superi l’altra o che la differenza abbia un’ampiezza rilevante.\n\nAbbiamo anche sottolineato l’importanza di iniziare dall’inferenza su una singola proporzione: questo passaggio preliminare ci ha permesso di familiarizzare con la logica bayesiana in un contesto semplice, prima di affrontare il caso più generale del confronto tra gruppi. L’uso di `brms` ha reso l’implementazione accessibile, mostrando come strumenti moderni consentano di stimare modelli complessi mantenendo intatta la logica concettuale dell’aggiornamento bayesiano.\n\nDal punto di vista psicologico, il messaggio è chiaro: non basta sapere se due proporzioni sono “significativamente diverse”. Dobbiamo chiederci *quanto* differiscono, quanto siamo incerti su questa differenza, e se l’effetto osservato abbia un senso pratico e teorico. Solo così l’analisi statistica può davvero informare le nostre decisioni scientifiche.\n\nNel prosieguo vedremo come lo stesso principio si applichi a una gamma più ampia di modelli all’interno della famiglia dei *GLM*: che si tratti di proporzioni, conteggi o esiti multinomiali, l’approccio bayesiano ci offre sempre una rappresentazione trasparente dell’incertezza e un linguaggio unificato per affrontare dati di natura diversa.\n\n::: {.callout-note collapse=true title=\"Informazioni sull'ambiente di sviluppo\"}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsessionInfo()\n#> R version 4.5.1 (2025-06-13)\n#> Platform: aarch64-apple-darwin20\n#> Running under: macOS Sequoia 15.6.1\n#> \n#> Matrix products: default\n#> BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib \n#> LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1\n#> \n#> locale:\n#> [1] C/UTF-8/C/C/C/C\n#> \n#> time zone: Europe/Rome\n#> tzcode source: internal\n#> \n#> attached base packages:\n#> [1] stats     graphics  grDevices utils     datasets  methods   base     \n#> \n#> other attached packages:\n#>  [1] scales_1.4.0          broom_1.0.9           bayestestR_0.17.0    \n#>  [4] cmdstanr_0.9.0        pillar_1.11.0         tinytable_0.13.0     \n#>  [7] patchwork_1.3.2       ggdist_3.3.3          tidybayes_3.0.7      \n#> [10] bayesplot_1.14.0      ggplot2_3.5.2         reliabilitydiag_0.2.1\n#> [13] priorsense_1.1.1      posterior_1.6.1       loo_2.8.0            \n#> [16] rstan_2.32.7          StanHeaders_2.32.10   brms_2.22.0          \n#> [19] Rcpp_1.1.0            sessioninfo_1.2.3     conflicted_1.2.0     \n#> [22] janitor_2.2.1         matrixStats_1.5.0     modelr_0.1.11        \n#> [25] tibble_3.3.0          dplyr_1.1.4           tidyr_1.3.1          \n#> [28] rio_1.2.3             here_1.0.1           \n#> \n#> loaded via a namespace (and not attached):\n#>  [1] gridExtra_2.3         inline_0.3.21         sandwich_3.1-1       \n#>  [4] rlang_1.1.6           magrittr_2.0.3        multcomp_1.4-28      \n#>  [7] snakecase_0.11.1      compiler_4.5.1        reshape2_1.4.4       \n#> [10] systemfonts_1.2.3     vctrs_0.6.5           stringr_1.5.1        \n#> [13] pkgconfig_2.0.3       arrayhelpers_1.1-0    fastmap_1.2.0        \n#> [16] backports_1.5.0       labeling_0.4.3        utf8_1.2.6           \n#> [19] rmarkdown_2.29        ps_1.9.1              ragg_1.5.0           \n#> [22] purrr_1.1.0           xfun_0.53             cachem_1.1.0         \n#> [25] jsonlite_2.0.0        parallel_4.5.1        R6_2.6.1             \n#> [28] stringi_1.8.7         RColorBrewer_1.1-3    lubridate_1.9.4      \n#> [31] estimability_1.5.1    knitr_1.50            zoo_1.8-14           \n#> [34] pacman_0.5.1          Matrix_1.7-4          splines_4.5.1        \n#> [37] timechange_0.3.0      tidyselect_1.2.1      abind_1.4-8          \n#> [40] yaml_2.3.10           codetools_0.2-20      curl_7.0.0           \n#> [43] processx_3.8.6        pkgbuild_1.4.8        plyr_1.8.9           \n#> [46] lattice_0.22-7        withr_3.0.2           bridgesampling_1.1-2 \n#> [49] coda_0.19-4.1         evaluate_1.0.5        survival_3.8-3       \n#> [52] RcppParallel_5.1.11-1 tensorA_0.36.2.1      checkmate_2.3.3      \n#> [55] stats4_4.5.1          insight_1.4.2         distributional_0.5.0 \n#> [58] generics_0.1.4        rprojroot_2.1.1       rstantools_2.5.0     \n#> [61] xtable_1.8-4          glue_1.8.0            emmeans_1.11.2-8     \n#> [64] tools_4.5.1           data.table_1.17.8     mvtnorm_1.3-3        \n#> [67] grid_4.5.1            QuickJSR_1.8.0        colorspace_2.1-1     \n#> [70] nlme_3.1-168          cli_3.6.5             textshaping_1.0.3    \n#> [73] svUnit_1.0.8          Brobdingnag_1.2-9     V8_7.0.0             \n#> [76] gtable_0.3.6          digest_0.6.37         TH.data_1.1-4        \n#> [79] htmlwidgets_1.6.4     farver_2.1.2          memoise_2.0.1        \n#> [82] htmltools_0.5.8.1     lifecycle_1.0.4       MASS_7.3-65\n```\n:::\n\n:::\n\n## Bibliografia {.unnumbered .unlisted}",
    "supporting": [
      "02_one_proportion_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}